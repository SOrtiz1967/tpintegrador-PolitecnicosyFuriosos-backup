<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDA - Cat√°logo de Autos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Catalogo.css">
</head>
<body>
<!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <img src="../imagenes_generales/logo_sin_fondo.png" alt="logo" width="100em" height="100em">
        <button class="navbar-toggler text-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <ul class="navbar-nav me-3">
            <li class="nav-item"><a class="nav-link" href="#">Marcas</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Garage</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Cat√°logo</a></li>
          </ul>
          <button class="btn btn-outline-light" id="perfilBtn" data-bs-toggle="modal" data-bs-target="#loginModal">
            Registrarse / Iniciar sesi√≥n
          </button>
        </div>
      </div>
    </nav>

<!-- Hero Section -->
<section class="hero-section">
    <div class="container text-center">
        <h1 class="hero-title">Cat√°logo de autos</h1>
        <p class="hero-subtitle">Lujo, tecnolog√≠a y exclusividad.</p>
        <div class="search-bar mx-auto">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInput" placeholder="Buscar por marca o modelo...">
                <button class="btn btn-warning" type="button" onclick="buscarAutos()">
                    üîç Buscar
                </button>
                <button class="btn btn-outline-secondary" type="button" onclick="limpiarBusqueda()" id="clearSearchBtn" style="display: none;">
                    ‚úï
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Categories Section -->
<section class="categories-section">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-3">
                <div class="category-card suv" data-tipo="SUV">
                    <div class="category-icon">
                    </div>
                    <h5 class="category-title">SUV</h5>
                </div>
            </div>
            <div class="col-md-3">
                <div class="category-card coupe" data-tipo="COUPE">
                    <div class="category-icon">
                    </div>
                    <h5 class="category-title">Coup√©</h5>
                </div>
            </div>
            <div class="col-md-3">
                <div class="category-card deportivo" data-tipo="DEPORTIVO">
                    <div class="category-icon">
                    </div>
                    <h5 class="category-title">Deportivo</h5>
                </div>
            </div>
            <div class="col-md-3">
                <div class="category-card disponible" data-disponible="true">
                    <div class="category-icon">
                    </div>
                    <h5 class="category-title">Disponible</h5>
                </div>
            </div>
        </div>
        
        <!-- Filtros activos -->
        <div class="row mt-4">
            <div class="col-12">
                <div id="filtrosActivos" class="d-flex flex-wrap gap-2" style="display: none !important;">
                    <!-- Los filtros activos se mostrar√°n aqu√≠ -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Grid Section -->
<section class="grid-section">
    <div class="container">
        <div class="row g-4" id="autosGrid">
            <!-- Los autos se cargar√°n din√°micamente aqu√≠ -->
        </div>
    </div>
</section>

<!-- Featured Section -->
<section class="featured-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="featured-card" id="ultimoLanzamientoCard">
                    <div class="featured-content text-center">
                        <div class="loading-text">
                            <p>Cargando √∫ltimo lanzamiento...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Todos los Autos Section -->
<section class="all-cars-section">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title mb-0">Todos los Autos</h2>
            <div class="results-info">
                <span id="contadorResultados" class="text-muted"></span>
            </div>
        </div>
        
        <div class="cars-grid" id="carsGrid">
            <div class="loading-text text-center">
                <p>Cargando autos...</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container text-center">
        <h2 class="cta-title">¬øListo para reservar?</h2>
        <p class="cta-subtitle">Elige tu auto so√±ado y da el<br>siguiente paso</p>
        <button class="btn btn-light btn-lg rounded-pill">Reservar ahora</button>
    </div>
</section>

<!-- Footer -->
<footer class="footer-premium">
    <div class="container">
      <div class="footer-content">
        <!-- Secci√≥n 1: Marca -->
        <div class="footer-section">
          <div class="footer-brand"><h4>P&F</h4></div>
          <p class="footer-tagline">Garage inteligente y autos de lujo</p>
          <p style="color: #666; font-size: 0.85rem; line-height: 1.6;">
            Experiment√° la excelencia en cada detalle. Desde estacionamiento premium hasta la flota m√°s exclusiva de autos de alta gama.
          </p>
        </div>

        <!-- Secci√≥n 2: Servicios -->
        <div class="footer-section">
          <h4>Servicios</h4>
          <ul>
            <li><a href="#estacionar">Estacionamiento Inteligente</a></li>
            <li><a href="#garage">Reservar Auto</a></li>
            <li><a href="#servicios">Mantenimiento Premium</a></li>
            <li><a href="#">Detailing & Personalizaci√≥n</a></li>
            <li><a href="#">Membres√≠as Exclusivas</a></li>
          </ul>
        </div>

        <!-- Secci√≥n 3: Empresa -->
        <div class="footer-section">
          <h4>Empresa</h4>
          <ul>
            <li><a href="#">Sobre Nosotros</a></li>
            <li><a href="#">Nuestra Flota</a></li>
            <li><a href="#">Marcas</a></li>
            <li><a href="#">Eventos & Experiencias</a></li>
            <li><a href="#">Contacto</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>¬© 2025 POLIT√âCNICOS Y FURIOSOS. Todos los derechos reservados.</p>
        <div class="footer-legal">
          <a href="#">T√©rminos y Condiciones</a>
          <a href="#">Pol√≠tica de Privacidad</a>
          <a href="#">Cookies</a>
        </div>
      </div>
    </div>
  </footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Variables globales
let todosLosAutos = [];
let filtroActual = {};

// Funci√≥n para cargar el √∫ltimo lanzamiento
async function cargarUltimoLanzamiento() {
    try {
        const response = await fetch('http://localhost:8080/api/autos/ultimo-lanzamiento');
        const ultimoLanzamiento = await response.json();
        
        mostrarUltimoLanzamiento(ultimoLanzamiento);
    } catch (error) {
        console.error('Error cargando √∫ltimo lanzamiento:', error);
        document.getElementById('ultimoLanzamientoCard').innerHTML = `
            <div class="featured-content text-center">
                <p class="text-warning">Error al cargar el √∫ltimo lanzamiento</p>
            </div>
        `;
    }
}

// Funci√≥n para mostrar el √∫ltimo lanzamiento
function mostrarUltimoLanzamiento(auto) {
    const featuredCard = document.getElementById('ultimoLanzamientoCard');
    
    featuredCard.innerHTML = `
        <div class="featured-content">
            <h6 class="featured-label">${auto.marca} ${auto.modelo} (√öltimo lanzamiento)</h6>
            <div class="row align-items-center">
                <div class="col-md-4">
                    ${auto.imagen1 ? `
                        <img src="${auto.imagen1}" alt="${auto.marca} ${auto.modelo}" 
                             class="img-fluid rounded featured-image">
                    ` : `
                        <div class="no-featured-image rounded">Sin imagen</div>
                    `}
                </div>
                <div class="col-md-8">
                    <p class="featured-description">
                        ${auto.descripcion || 'Descripci√≥n no disponible.'}
                    </p>
                    <div class="featured-details mt-3">
                        <div class="row">
                            <div class="col-6">
                                <strong>A√±o:</strong> ${auto.anio}
                            </div>
                            <div class="col-6">
                                <strong>Precio:</strong> $${auto.precioPorDia}/d√≠a
                            </div>
                            <div class="col-6">
                                <strong>Tipo:</strong> ${auto.tipo || 'N/A'}
                            </div>
                            <div class="col-6">
                                <strong>Estado:</strong> 
                                ${auto.disponible ? 
                                    '<span class="text-success">Disponible</span>' : 
                                    '<span class="text-warning">No disponible</span>'
                                }
                            </div>
                        </div>
                    </div>
                    <div class="featured-actions mt-4">
                        <button class="btn btn-warning me-2" onclick="reservarAuto(${auto.id})" 
                            ${!auto.disponible ? 'disabled' : ''}>
                            ${auto.disponible ? 'Reservar ahora' : 'No disponible'}
                        </button>
                        <button class="btn btn-outline-light" onclick="verDetalleAuto(${auto.id})">
                            Ver detalles
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Funci√≥n principal para cargar autos con filtros
async function cargarAutos(filtros = {}) {
    try {
        mostrarLoading();
        
        const params = new URLSearchParams();
        if (filtros.tipo) params.append('tipo', filtros.tipo);
        if (filtros.disponible !== undefined) params.append('disponible', filtros.disponible);
        if (filtros.search) params.append('search', filtros.search);
        
        const response = await fetch(`http://localhost:8080/api/autos/catalogo?${params}`);
        const autos = await response.json();
        
        // Guardar todos los autos para b√∫squedas locales si es necesario
        if (Object.keys(filtros).length === 0) {
            todosLosAutos = autos;
        }
        
        // Actualizar ambas secciones
        mostrarAutosEnGrid(autos);
        mostrarTodosLosAutos(autos);
        actualizarFiltrosActivos();
        actualizarContadorResultados(autos.length);
        
    } catch (error) {
        console.error('Error cargando cat√°logo:', error);
        mostrarError();
    }
}

// Funci√≥n para mostrar estado de carga
function mostrarLoading() {
    document.getElementById('autosGrid').innerHTML = `
        <div class="col-12 text-center">
            <div class="spinner-border text-warning" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-muted mt-2">Cargando autos...</p>
        </div>
    `;
    
    document.getElementById('carsGrid').innerHTML = `
        <div class="loading-text text-center">
            <div class="spinner-border text-warning" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-muted mt-2">Cargando autos...</p>
        </div>
    `;
}

// Funci√≥n para mostrar error
function mostrarError() {
    document.getElementById('autosGrid').innerHTML = 
        '<div class="col-12 text-center"><p class="text-warning">Error al cargar los autos</p></div>';
    document.getElementById('carsGrid').innerHTML = 
        '<div class="error-text text-center"><p>Error al cargar los autos</p></div>';
}

// Funci√≥n para buscar autos
function buscarAutos() {
    const searchTerm = document.getElementById('searchInput').value.trim();
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    
    if (searchTerm) {
        // Aplicar filtro de b√∫squeda
        filtroActual.search = searchTerm;
        clearSearchBtn.style.display = 'block';
    } else {
        // Si no hay t√©rmino de b√∫squeda, quitar el filtro
        delete filtroActual.search;
        clearSearchBtn.style.display = 'none';
    }
    
    cargarAutos(filtroActual);
}

// Funci√≥n para limpiar b√∫squeda
function limpiarBusqueda() {
    document.getElementById('searchInput').value = '';
    document.getElementById('clearSearchBtn').style.display = 'none';
    delete filtroActual.search;
    cargarAutos(filtroActual);
}

// Funci√≥n para aplicar filtro por categor√≠a
function aplicarFiltroCategoria(tipo, disponible) {
    // Limpiar b√∫squeda cuando se usa filtro de categor√≠a
    document.getElementById('searchInput').value = '';
    document.getElementById('clearSearchBtn').style.display = 'none';
    
    if (tipo) {
        filtroActual.tipo = tipo;
        delete filtroActual.disponible;
    } else if (disponible) {
        filtroActual.disponible = true;
        delete filtroActual.tipo;
    }
    
    cargarAutos(filtroActual);
}

// Funci√≥n para quitar filtro
function quitarFiltro(clave) {
    delete filtroActual[clave];
    cargarAutos(filtroActual);
}

// Funci√≥n para limpiar todos los filtros
function limpiarTodosLosFiltros() {
    filtroActual = {};
    document.getElementById('searchInput').value = '';
    document.getElementById('clearSearchBtn').style.display = 'none';
    cargarAutos();
}

// Funci√≥n para actualizar filtros activos
function actualizarFiltrosActivos() {
    const filtrosActivos = document.getElementById('filtrosActivos');
    const filtros = Object.keys(filtroActual);
    
    if (filtros.length === 0) {
        filtrosActivos.style.display = 'none';
        return;
    }
    
    filtrosActivos.style.display = 'flex';
    filtrosActivos.innerHTML = `
        <span class="text-muted">Filtros activos:</span>
        ${filtros.map(clave => {
            let valor = filtroActual[clave];
            let texto = '';
            
            if (clave === 'tipo') {
                texto = `Tipo: ${valor}`;
            } else if (clave === 'disponible') {
                texto = 'Solo disponibles';
            } else if (clave === 'search') {
                texto = `B√∫squeda: "${valor}"`;
            }
            
            return `
                <span class="badge bg-warning text-dark d-flex align-items-center">
                    ${texto}
                    <button type="button" class="btn-close btn-close-white ms-1" 
                            onclick="quitarFiltro('${clave}')" 
                            style="font-size: 0.7rem;"></button>
                </span>
            `;
        }).join('')}
        ${filtros.length > 1 ? `
            <button class="btn btn-outline-warning btn-sm" onclick="limpiarTodosLosFiltros()">
                Limpiar todos
            </button>
        ` : ''}
    `;
}

// Funci√≥n para actualizar contador de resultados
function actualizarContadorResultados(cantidad) {
    const contador = document.getElementById('contadorResultados');
    const filtros = Object.keys(filtroActual);
    
    if (filtros.length === 0) {
        contador.textContent = `${cantidad} autos encontrados`;
    } else {
        contador.textContent = `${cantidad} autos encontrados con los filtros aplicados`;
    }
}

// Funci√≥n para mostrar autos en el grid principal
function mostrarAutosEnGrid(autos) {
    const gridSection = document.getElementById('autosGrid');
    
    if (!autos || autos.length === 0) {
        gridSection.innerHTML = `
            <div class="col-12 text-center">
                <p class="text-muted">No se encontraron autos</p>
                ${Object.keys(filtroActual).length > 0 ? `
                    <button class="btn btn-outline-warning btn-sm" onclick="limpiarTodosLosFiltros()">
                        Mostrar todos los autos
                    </button>
                ` : ''}
            </div>
        `;
        return;
    }
    
    // Mostrar m√°ximo 4 autos en el grid principal
    const autosParaMostrar = autos.slice(0, 4);
    
    gridSection.innerHTML = autosParaMostrar.map(auto => `
        <div class="col-md-6">
            <div class="grid-card" style="background-image: url('${auto.imagen1 || ''}')" onclick="verDetalleAuto(${auto.id})">
                <div class="card-content text-white p-3">
                    <h5>${auto.marca} ${auto.modelo}</h5>
                    <p>${auto.anio} ‚Ä¢ $${auto.precioPorDia}/d√≠a</p>
                    <small class="badge bg-dark">${auto.tipo || 'N/A'}</small>
                    ${auto.disponible ? '<span class="badge bg-success ms-1">Disponible</span>' : '<span class="badge bg-secondary ms-1">No disponible</span>'}
                </div>
            </div>
        </div>
    `).join('');
}

// Funci√≥n para mostrar todos los autos en la secci√≥n inferior
function mostrarTodosLosAutos(autos) {
    const carsGrid = document.getElementById('carsGrid');
    
    if (!autos || autos.length === 0) {
        carsGrid.innerHTML = `
            <div class="no-cars-text text-center">
                <p>No se encontraron autos</p>
                ${Object.keys(filtroActual).length > 0 ? `
                    <button class="btn btn-outline-warning btn-sm" onclick="limpiarTodosLosFiltros()">
                        Mostrar todos los autos
                    </button>
                ` : ''}
            </div>
        `;
        return;
    }
    
    carsGrid.innerHTML = autos.map(auto => `
        <div class="car-card" data-id="${auto.id}">
            <div class="car-header">
                <h4 class="car-title">${auto.marca} ${auto.modelo}</h4>
                <span class="car-year">${auto.anio}</span>
            </div>
            
            <div class="car-image">
                ${auto.imagen1 ? 
                    `<img src="${auto.imagen1}" alt="${auto.marca} ${auto.modelo}" class="car-img">` : 
                    '<div class="no-image">Sin imagen</div>'
                }
            </div>
            
            <div class="car-details">
                <div class="car-price">
                    <strong>$${auto.precioPorDia}/d√≠a</strong>
                </div>
                <div class="car-type">
                    <span class="badge ${auto.tipo ? auto.tipo.toLowerCase() : 'default'}">${auto.tipo || 'N/A'}</span>
                </div>
                <div class="car-availability">
                    ${auto.disponible ? 
                        '<span class="available">‚úÖ Disponible</span>' : 
                        '<span class="not-available">‚ùå No disponible</span>'
                    }
                </div>
            </div>
            
            ${auto.descripcion ? `
                <div class="car-description">
                    <p class="car-tag">${auto.descripcion}</p>
                </div>
            ` : ''}
            
            <div class="car-actions">
                <button class="btn btn-reserve" onclick="reservarAuto(${auto.id})" 
                    ${!auto.disponible ? 'disabled' : ''}>
                    ${auto.disponible ? 'Reservar ahora' : 'No disponible'}
                </button>
            </div>
        </div>
    `).join('');
}

// Funci√≥n para reservar auto
function reservarAuto(autoId) {
    // Redirigir a p√°gina de reserva o mostrar modal
    alert(`Reservando auto ID: ${autoId}`);
    // window.location.href = `/reserva.html?autoId=${autoId}`;
}

// Funci√≥n para ver detalle del auto
function verDetalleAuto(autoId) {
    // Redirigir a p√°gina de detalle
    alert(`Viendo detalle del auto ID: ${autoId}`);
    // window.location.href = `/detalle-auto.html?autoId=${autoId}`;
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Cargar todos los autos al inicio
    cargarAutos();
    
    // Cargar √∫ltimo lanzamiento
    cargarUltimoLanzamiento();
    
    // Buscar al presionar Enter
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            buscarAutos();
        }
    });
    
    // Filtros por categor√≠a
    document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function() {
            const tipo = this.getAttribute('data-tipo');
            const disponible = this.getAttribute('data-disponible');
            
            aplicarFiltroCategoria(tipo, disponible);
        });
    });
});

// Script para el perfil de usuario
const user = JSON.parse(sessionStorage.getItem("cliente")); 
const perfilBtn = document.getElementById("perfilBtn");

if(user){
    perfilBtn.textContent = `${user.nombre} ${user.apellido}`;
    perfilBtn.classList.remove("btn-outline-light");
    perfilBtn.classList.add("btn-success");
    perfilBtn.style.whiteSpace = "nowrap";
    perfilBtn.removeAttribute("data-bs-toggle");
    perfilBtn.removeAttribute("data-bs-target");
    perfilBtn.onclick = () => window.location.href = "../Perfil/perfil.html";
}
</script>

</body>
</html>